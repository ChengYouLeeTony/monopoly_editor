<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    <script src="node_modules/jquery/dist/jquery.min.js"></script>
    <script src="node_modules/blockly/blockly_compressed.js"></script>
    <script src="node_modules/blockly/python_compressed.js"></script>
    <script src="node_modules/blockly/blocks_compressed.js"></script>
    <script src="node_modules/blockly/msg/zh-hant.js"></script>
    <div id="blocklyDiv" style="height: 480px; width: 600px;"></div>
    <p id="textarea"></p>
    <xml id="toolbox" style="display: none">
      <block type="controls_if"></block>
      <block type="controls_repeat_ext"></block>
      <block type="logic_compare"></block>
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
      <block type="text"></block>
      <category name="邏輯">
          <block type="controls_if"></block>
          <block type="controls_repeat_ext"></block>
          <block type="logic_compare"></block>
          <block type="text"></block>
          <block type="text_print"></block>
      </category>
      <category name="變數比較">
          <block type="variable_vs_variable"></block>
          <block type="variable_vs_number"></block>
          <block type="number_vs_variable"></block>
      </category>
      <block type="text_print"></block>
    </xml>
    <script>
        var workspace = Blockly.inject('blocklyDiv',
        {toolbox: document.getElementById('toolbox')});

        Blockly.Blocks['variable_vs_variable'] = {
          init: function() {
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([["金錢","money"], ["x1","x1"], ["x2","x2"], ["x3","x3"], ["x4","x4"], ["x5","x5"]]), "choice_1")
                .appendField(new Blockly.FieldDropdown([["=","=="], ["≠","!="], ["<","<"], ["‏≤","‏<="], [">",">"], ["‏≥","‏>="]]), "compare")
                .appendField(new Blockly.FieldDropdown([["金錢","money"], ["x1","x1"], ["x2","x2"], ["x3","x3"], ["x4","x4"], ["x5","x5"]]), "choice_2");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setColour(230);
         this.setTooltip("變數和變數進行比較");
         this.setHelpUrl("");
          }
        };
        Blockly.Blocks['variable_vs_number'] = {
          init: function() {
            this.appendDummyInput()
                .appendField(new Blockly.FieldDropdown([["金錢","money"], ["x1","x1"], ["x2","x2"], ["x3","x3"], ["x4","x4"], ["x5","x5"]]), "choice_1")
                .appendField(new Blockly.FieldDropdown([["=","=="], ["≠","!="], ["<","<"], ["‏≤","‏p<="], [">",">"], ["‏≥","‏p>="]]), "compare")
                .appendField(new Blockly.FieldNumber(0, -Infinity, Infinity, 0.1), "number");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setColour(230);
         this.setTooltip("變數和數值進行比較");
         this.setHelpUrl("");
          }
        };
        Blockly.Blocks['number_vs_variable'] = {
          init: function() {
            this.appendDummyInput()
                .appendField(new Blockly.FieldNumber(0, -Infinity, Infinity, 0.1), "number")
                .appendField(new Blockly.FieldDropdown([["=","=="], ["≠","!="], ["<","<"], ["‏≤","<="], [">",">"], ["‏≥",">="]]), "compare")
                .appendField(new Blockly.FieldDropdown([["金錢","money"], ["x1","x1"], ["x2","x2"], ["x3","x3"], ["x4","x4"], ["x5","x5"]]), "choice_1");
            this.setInputsInline(true);
            this.setOutput(true, "Boolean");
            this.setColour(230);
         this.setTooltip("數值和變數進行比較");
         this.setHelpUrl("");
          }
        };

        Blockly.Python['variable_vs_variable'] = function(block) {
          var dropdown_choice_1 = block.getFieldValue('choice_1');
          var dropdown_compare = block.getFieldValue('compare');
          var dropdown_choice_2 = block.getFieldValue('choice_2');
          // TODO: Assemble Python into code variable.
          var code = [dropdown_choice_1, dropdown_compare, dropdown_choice_2].join(' ');
          // TODO: Change ORDER_NONE to the correct strength.
          return [code, Blockly.Python.ORDER_RELATIONAL];
        };
        Blockly.Python['variable_vs_number'] = function(block) {
          var dropdown_choice_1 = block.getFieldValue('choice_1');
          var dropdown_compare = block.getFieldValue('compare');
          if (dropdown_compare.length == 4) {
            dropdown_compare = dropdown_compare.slice(2,)
          }
          var number_number = block.getFieldValue('number');
          // TODO: Assemble Python into code variable.
          var code = [dropdown_choice_1, dropdown_compare, number_number].join(' ');
          // TODO: Change ORDER_NONE to the correct strength.
          return [code, Blockly.Python.ORDER_RELATIONAL];
        };
        Blockly.Python['number_vs_variable'] = function(block) {
          var number_number = block.getFieldValue('number');
          var dropdown_compare = block.getFieldValue('compare');
          var dropdown_choice_1 = block.getFieldValue('choice_1');
          // TODO: Assemble Python into code variable.
          var code = [number_number, dropdown_compare, dropdown_choice_1].join(' ');
          // TODO: Change ORDER_NONE to the correct strength.
          return [code, Blockly.Python.ORDER_RELATIONAL];
        };



      function myUpdateFunction(event) {
          var code = Blockly.Python.workspaceToCode(workspace);
          document.getElementById('textarea').innerHTML = code;
        }
        workspace.addChangeListener(myUpdateFunction);
    </script>
</body>
</html>